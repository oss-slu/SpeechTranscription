name: Build macOS Executable

on:
  push:
    branches:
      - main
      - issue182_releaseprocess

jobs:
  build-macos:
    runs-on: macos-latest

    steps:
      # Step 1: Checkout the code
      - name: Checkout code
        uses: actions/checkout@v4

      # Step 2: Make the build script executable
      - name: Make build script executable
        run: chmod +x .github/workflows/build-saltify.sh

      # Step 3: Install required system tools
      - name: Install Required System Tools
        run: |
          brew install pkg-config mysql-client
          export PATH="/usr/local/opt/mysql-client/bin:$PATH"
          export PKG_CONFIG_PATH="/usr/local/opt/mysql-client/lib/pkgconfig"
          export MYSQLCLIENT_CFLAGS="-I/usr/local/opt/mysql-client/include"
          export MYSQLCLIENT_LDFLAGS="-L/usr/local/opt/mysql-client/lib"

      # Step 4: Configure Java environment
      - name: Configure Java Environment
        run: |
          export JAVA_HOME=$(/usr/libexec/java_home)
          export PATH="$JAVA_HOME/bin:$PATH"
          java -version

      # Step 5: Run the build script
      - name: Run Saltify Build Script
        run: ./workflows/build-saltify.sh

      # Step 6: Verify the build output
      - name: Debug build directory
        run: |
          echo "Contents of the dist directory:"
          ls -la dist/

      # Step 7: Upload the built artifact
      - name: Upload macOS Build Artifact
        uses: actions/upload-artifact@v4
        with:
          name: SpeechTranscription_macos
          path: dist/Saltify
